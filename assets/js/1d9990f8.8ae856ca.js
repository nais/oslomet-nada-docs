"use strict";(self.webpackChunknada=self.webpackChunknada||[]).push([[187],{3905:function(e,a,n){n.d(a,{Zo:function(){return p},kt:function(){return c}});var t=n(7294);function r(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function i(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);a&&(t=t.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,t)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?i(Object(n),!0).forEach((function(a){r(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function o(e,a){if(null==e)return{};var n,t,r=function(e,a){if(null==e)return{};var n,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||(r[n]=e[n]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)n=i[t],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=t.createContext({}),s=function(e){var a=t.useContext(d),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},p=function(e){var a=s(e.components);return t.createElement(d.Provider,{value:a},e.children)},k={inlineCode:"code",wrapper:function(e){var a=e.children;return t.createElement(t.Fragment,{},a)}},u=t.forwardRef((function(e,a){var n=e.components,r=e.mdxType,i=e.originalType,d=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=s(n),c=r,g=u["".concat(d,".").concat(c)]||u[c]||k[c]||i;return n?t.createElement(g,l(l({ref:a},p),{},{components:n})):t.createElement(g,l({ref:a},p))}));function c(e,a){var n=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=u;var o={};for(var d in a)hasOwnProperty.call(a,d)&&(o[d]=a[d]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var s=2;s<i;s++)l[s]=n[s];return t.createElement.apply(null,l)}return t.createElement.apply(null,n)}u.displayName="MDXCreateElement"},3708:function(e,a,n){n.r(a),n.d(a,{frontMatter:function(){return o},contentTitle:function(){return d},metadata:function(){return s},toc:function(){return p},default:function(){return u}});var t=n(7462),r=n(3366),i=(n(7294),n(3905)),l=["components"],o={title:"Datapakker"},d=void 0,s={unversionedId:"dele-innsikt/data-packages",id:"dele-innsikt/data-packages",isDocsHomePage:!1,title:"Datapakker",description:"Hvorfor datapakker",source:"@site/docs/dele-innsikt/data-packages.md",sourceDirName:"dele-innsikt",slug:"/dele-innsikt/data-packages",permalink:"/dele-innsikt/data-packages",editUrl:"https://github.com/navikt/nada/edit/main/docs/dele-innsikt/data-packages.md",tags:[],version:"current",frontMatter:{title:"Datapakker"},sidebar:"docs",previous:{title:"Registrere dataprodukt",permalink:"/dele-data/registrere-dataprodukt"},next:{title:"Metabase",permalink:"/dele-innsikt/metabase"}},p=[{value:"Hvorfor datapakker",id:"hvorfor-datapakker",children:[]},{value:"Lage datapakker med notebooks",id:"lage-datapakker-med-notebooks",children:[{value:"Definer metadata",id:"definer-metadata",children:[]},{value:"Legg til innhold i datapakker",id:"legg-til-innhold-i-datapakker",children:[]},{value:"Publiser til NAV datapakke katalog",id:"publiser-til-nav-datapakke-katalog",children:[]}]},{value:"Publisering av datapakker utenom notebooks",id:"publisering-av-datapakker-utenom-notebooks",children:[{value:"Publisering av datapakker via api",id:"publisering-av-datapakker-via-api",children:[]},{value:"Lag en ny datapakke",id:"lag-en-ny-datapakke",children:[]},{value:"Legg til view og ressursfiler",id:"legg-til-view-og-ressursfiler",children:[]},{value:"Oppdatering av datapakke",id:"oppdatering-av-datapakke",children:[]},{value:"Eksempel datapackage.json som inkluderer en data visualisering",id:"eksempel-datapackagejson-som-inkluderer-en-data-visualisering",children:[]}]},{value:"Eksempel datapackage.json som inkluderer referanser til en datafil og en plotly figur",id:"eksempel-datapackagejson-som-inkluderer-referanser-til-en-datafil-og-en-plotly-figur",children:[{value:"Publisering til data.nav.no",id:"publisering-til-datanavno",children:[]}]}],k={toc:p};function u(e){var a=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,t.Z)({},k,n,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"hvorfor-datapakker"},"Hvorfor datapakker"),(0,i.kt)("p",null,"Med datapakker kan du lage og publisere datafortellinger direkte fra notebooks eller skript. Du kan kombinere datavisualiseringer med\nformattert tekst, tabeller, bilder, html og PDFer til \xe5 lage en datapakke. Den enkleste veien til \xe5 lage datapakker er ved \xe5 bruke notebooks. Se ",(0,i.kt)("a",{href:"https://deetly.github.io/docs/intro.html"},"deetly")," for eksempler og getting started dokumentasjon."),(0,i.kt)("h2",{id:"lage-datapakker-med-notebooks"},"Lage datapakker med notebooks"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"import deetly\nfrom dataverk import Client\n")),(0,i.kt)("h3",{id:"definer-metadata"},"Definer metadata"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# Lag en datapakker\nmetadata = {\n    "name":"Hello world"\n}\nds = deetly.story(metadata)\n')),(0,i.kt)("h3",{id:"legg-til-innhold-i-datapakker"},"Legg til innhold i datapakker"),(0,i.kt)("p",null,"Innhold kan v\xe6re tekst som vist i dette eksempelet. Men innhold kan ogs\xe5 v\xe6re markdown, datavisualiseringer eller dashboards. Flere eksempler kan finnes p\xe5 ",(0,i.kt)("a",{href:"https://deetly.github.io/docs/intro.html"},"deetly"),". Du kan legge til flere innholdselementer i en datapakker."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# Legg en tekst til i datapakkeren\nds.text("Glad you are here!")\n')),(0,i.kt)("h3",{id:"publiser-til-nav-datapakke-katalog"},"Publiser til NAV datapakke katalog"),(0,i.kt)("p",null,"Med naisdevice installert og kj\xf8rende kan du publisere til datapakke-katalogen direkte fra maskinen din. I dette tilfellet trenger du \xe5 definere noen milj\xf8variabler for \xe5 publisere enten til test (",(0,i.kt)("a",{href:"https://datapakker.dev.intern.nav.no"},(0,i.kt)("a",{parentName:"p",href:"https://datapakker.dev.intern.nav.no"},"https://datapakker.dev.intern.nav.no")),") eller prod (",(0,i.kt)("a",{href:"https://datapakker.intern.nav.no"},(0,i.kt)("a",{parentName:"p",href:"https://datapakker.intern.nav.no"},"https://datapakker.intern.nav.no")),")."),(0,i.kt)("p",null,"N\xe5r man jobber i notebooks p\xe5 .jupyter.adeo.no er det ikke n\xf8dvendig \xe5 sette disse."),(0,i.kt)("h4",{id:"for-dataverk-047"},"For dataverk >=0.4.7"),(0,i.kt)("h5",{id:"publish-from-onprem"},"Publish from onprem"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"import os\n# publish to test: https://data.dev.intern.nav.no\nos.environ['DATAVERK_HOST'] = 'https://datakatalog-api.dev.intern.nav.no'\n\n# publish to prod: https://data.intern.nav.no\n# os.environ['DATAVERK_HOST'] = 'https://datakatalog-api.intern.nav.no'\n\nos.environ['DATAVERK_ENVIRONMENT'] = 'nais'\n")),(0,i.kt)("h5",{id:"publish-from-gcp-project"},"Publish from gcp project"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"os.environ['DATAVERK_HOST'] = 'https://data-catalog-es-api.nav.no'\nos.environ['DATAVERK_BUCKET'] = 'nav-interndata-prod-gcp'\nos.environ['DATAVERK_ENVIRONMENT'] = 'gcs'\n")),(0,i.kt)("h4",{id:"for-dataverk-047-1"},"For dataverk <0.4.7"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"import os\n# publish to test: https://data.dev.intern.nav.no\nos.environ['DATAVERK_ES_HOST'] = 'https://datakatalog-api.dev.intern.nav.no/v1/index'\nos.environ['DATAVERK_BUCKET_ENDPOINT'] = 'https://dv-api-intern.dev-gcp.nais.io/storage'\nos.environ['DATAVERK_API_ENDPOINT'] = 'https://data.dev.intern.nav.no/api'\n\n# publish to prod: https://data.intern.nav.no\n#os.environ['DATAVERK_ES_HOST'] = 'https://datakatalog-api.intern.nav.no/v1/index'\n#os.environ['DATAVERK_BUCKET_ENDPOINT'] = 'https://dv-api-intern.prod-gcp.nais.io/storage'\n#os.environ['DATAVERK_API_ENDPOINT'] ='https://data.intern.nav.no/api'\n\n# publish from onprem\nos.environ['DATAVERK_BUCKET'] ='nav-interndata'\nos.environ['DATAVERK_STORAGE_SINK'] = 'nais'\n")),(0,i.kt)("p",null,"Alt er n\xe5 satt. N\xe5r du n\xe5 kaller publish() metoden vil datapakker din umiddelbart v\xe6re tilgjengelig i datapakke-katalogen."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"Client().publish(ds)\n")),(0,i.kt)("h2",{id:"publisering-av-datapakker-utenom-notebooks"},"Publisering av datapakker utenom notebooks"),(0,i.kt)("p",null,"Det er ogs\xe5 mulig \xe5 publisere datapakker med andre programmeringsspr\xe5k og uten \xe5 bruke notebooks."),(0,i.kt)("p",null,"En datapakke er bare en deklarativ spesifikasjon i JSON format. Datapakken kan ogs\xe5 inneholde data og/eller referanser til datakilder."),(0,i.kt)("p",null,"Datapakke JSON objektet inneholder:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"metadata"),(0,i.kt)("li",{parentName:"ul"},"en liste av 0-n data 'ressurser'"),(0,i.kt)("li",{parentName:"ul"},"en liste av 0-n innholdselement deklarasjoner (='views')")),(0,i.kt)("p",null,"Eksempelet under inneholder et view av type markdown og ingen data ressurser:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "name": "Hello world", \n    "issued": "2021-03-03T19:23:34.160098", \n    "modified": "2021-03-03T19:23:34.160098", \n    "title": "Hello world", \n    "id": "aae98ae8214549d11861eb9fd7234ba5", \n    "views": [\n        {\n            "name": "Hello World",\n            "description": "", \n            "specType": "markdown", \n            "spec": {"markdown": "Hello World"}\n        }\n    ]\n}\n')),(0,i.kt)("h3",{id:"publisering-av-datapakker-via-api"},"Publisering av datapakker via api"),(0,i.kt)("p",null,'N\xe5r man publiserer en datapakke vil JSON deklarasjonen sammen med eventuelle ressursfiler bli skrevet til filer i en bucket store via et API. Filene kan s\xe5 akksesseres av\nen "datapakke-viewer" front-end applikasjon.'),(0,i.kt)("p",null,"Det f\xf8lgende eksempelet viser hvordan man publiserer en datapakke JSON fil til dev milj\xf8et (",(0,i.kt)("a",{parentName:"p",href:"https://datapakker.dev.intern.nav.no"},"https://datapakker.dev.intern.nav.no"),")"),(0,i.kt)("p",null,"For \xe5 publisere til prod m\xe5 du bruke API adressen: ",(0,i.kt)("a",{parentName:"p",href:"https://datakatalog-api.intern.nav.no"},"https://datakatalog-api.intern.nav.no"),"."),(0,i.kt)("h3",{id:"lag-en-ny-datapakke"},"Lag en ny datapakke"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"curl -X 'POST' -H \"Content-Type: application/json\" -d @datapakke.json 'https://datakatalog-api.dev.intern.nav.no/v1/datapackage'\n")),(0,i.kt)("p",null,"Hvis alt g\xe5r bra vil du da f\xe5 en respons med IDen til datapakken din:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n  "id": "1c9c6c7c40812e207946632dcc4be58f",\n  "status": "Successfully created datapackage min datapakke"\n}\n')),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Merk deg IDen som returneres. Du trenger denne dersom du \xf8nsker \xe5 oppdatere datapakken"))),(0,i.kt)("h3",{id:"legg-til-view-og-ressursfiler"},"Legg til view og ressursfiler"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"curl -X PUT -F files=@resource.csv -F files=@testfigur.json https://datakatalog-api.dev.intern.nav.no/v1/datapackage/1c9c6c7c40812e207946632dcc4be58f/attachments\n")),(0,i.kt)("h3",{id:"oppdatering-av-datapakke"},"Oppdatering av datapakke"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"curl -X 'PUT' -H \"Content-Type: application/json\" -d @datapakke.json 'https://datakatalog-api.dev.intern.nav.no/v1/datapackage/1c9c6c7c40812e207946632dcc4be58f'\n")),(0,i.kt)("h3",{id:"eksempel-datapackagejson-som-inkluderer-en-data-visualisering"},"Eksempel datapackage.json som inkluderer en data visualisering"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "title": "Echarts demo datapakke",\n  "description": "Echarts demo datapakke",\n  "views": [\n    {\n      "title": "Echart demofigur",\n      "description": "Dette er en testfigur",\n      "specType": "echart",\n      "spec": { \n          "option": \n            {\n                "xAxis": {\n                    "type": "category",\n                    "data": ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]\n                },\n                "yAxis": {\n                    "type": "value"\n                },\n                "series": [{\n                    "data": [150, 230, 224, 218, 135, 147, 260],\n                    "type": "line"\n                }]\n            }\n        }\n    }\n  ]\n}\n')),(0,i.kt)("h2",{id:"eksempel-datapackagejson-som-inkluderer-referanser-til-en-datafil-og-en-plotly-figur"},"Eksempel datapackage.json som inkluderer referanser til en datafil og en plotly figur"),(0,i.kt)("p",null,"N\xe5r du inkluderer figurer som inneholder store datamengder kan du redusere lastetiden til datapakken hvis du lagrer figurens spesifikasjon som separate filer og inkluderer bare URLen i datapackage.json"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "title": "Plotly demo datapakke",\n  "description": "Datapakke med et plotly view og en nedlastbar fil",\n  "views": [\n    {\n      "title": "Testfigur",\n      "description": "Dette er en testfigur",\n      "specType": "plotly",\n      "spec": {\n        "url": "testfigur.json"\n      }\n    }\n  ],\n  "resources": [\n    {\n      "name": "resource",\n      "description": "dette er en testressurs",\n      "path": "resource.csv",\n      "format": "csv",\n      "dsv_separator": ";"\n    }\n  ]\n}\n')),(0,i.kt)("h3",{id:"publisering-til-datanavno"},"Publisering til data.nav.no"),(0,i.kt)("p",null,"Hvis datapakken skal publiseres offentlig m\xe5 man legge ved metadata som f\xf8lger DCAT-AP-NO standarden. Eksempel:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'metadata = {\n    "name":"Hello unique world", \n    "title": "Hello world", \n    "description": "Friendly greeting",\n    "keywords": ["greeting"],\n    "scope": "team hello",\n    "author": "team hello",\n    "publisher": {"name": "team hello", "email": "hello@world" },\n    "license": {"name": "MIT", "email": "https://opensource.org/licenses/MIT"},\n    "contactPoint": {"name": "team hello", "email": "hello@world" },\n    "temporal": {"from": "2000-01-01", "to": "2030-01-01"},\n    "spatial": "Norge"\n    }\n')),(0,i.kt)("p",null,"Ta kontakt i #nada p\xe5 Slack dersom du trenger hjelp."))}u.isMDXComponent=!0}}]);